<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আমার ক্লাসরুম - ড্যাশবোর্ড</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: ltr;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 1000;
        }

        .menu-icon {
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
            margin-right: 16px;
        }

        .menu-icon:hover {
            background-color: #f5f5f5;
        }

        .header-title {
            flex: 1;
            font-size: 20px;
            font-weight: 500;
            color: #1976d2;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1976d2;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-email {
            font-size: 14px;
            color: #666;
        }

        .role-badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
            margin-top: 2px;
        }

        .role-badge.teacher {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .role-badge.student {
            background: #e3f2fd;
            color: #1565c0;
        }

        .role-badge.new {
            background: #fff3e0;
            color: #ef6c00;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: -280px;
            top: 64px;
            width: 280px;
            height: calc(100vh - 64px);
            background: white;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 999;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-content {
            padding: 24px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 8px;
        }

        .sidebar-item:hover {
            background-color: #f5f5f5;
        }

        .sidebar-item.active {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .sidebar-item .material-icons {
            margin-right: 12px;
        }

        .logout-btn {
            margin-top: auto;
            background: #f44336;
            color: white;
        }

        .logout-btn:hover {
            background: #d32f2f;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-top: 64px;
            padding: 24px;
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-open {
            margin-left: 280px;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .content-title {
            font-size: 28px;
            font-weight: 600;
            color: white;
        }

        .add-course-container {
            position: relative;
        }

        .add-course-btn {
            background: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 500;
            color: #1976d2;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .add-course-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .course-action-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 100;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s;
            pointer-events: none;
            margin-top: 8px;
        }

        .course-action-menu.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .dropdown-item .material-icons {
            margin-right: 12px;
            color: #666;
        }

        /* Courses Grid */
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .course-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .course-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .course-card.archived {
            opacity: 0.7;
        }

        .course-header {
            padding: 20px;
            color: white;
            position: relative;
            background: linear-gradient(135deg, #1976d2, #1565c0);
        }

        .course-header.math {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .course-header.science {
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }

        .course-header.bangla {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .course-header.english {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2);
        }

        .course-header.programming {
            background: linear-gradient(135deg, #607d8b, #455a64);
        }

        .course-header-content {
            position: relative;
            z-index: 2;
        }

        .course-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .course-section {
            font-size: 14px;
            opacity: 0.9;
        }

        .course-header-menu {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 3;
        }

        .course-card-menu {
            position: relative;
        }

        .course-menu {
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .course-menu:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .course-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            min-width: 150px;
            z-index: 1000;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.3s;
            pointer-events: none;
            margin-top: 4px;
        }

        .course-menu-dropdown.show {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .course-menu-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
            color: #333;
        }

        .course-menu-item:hover {
            background-color: #f5f5f5;
        }

        .course-menu-item.delete:hover {
            background-color: #ffebee;
            color: #f44336;
        }

        .course-menu-item.archive:hover {
            background-color: #fff3e0;
            color: #ff9800;
        }

        .course-menu-item .material-icons {
            margin-right: 8px;
            font-size: 20px;
        }

        .course-body {
            padding: 20px;
        }

        .course-body-content {
            margin-bottom: 16px;
        }

        .course-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .course-code {
            font-weight: 600;
            color: #1976d2;
            font-size: 14px;
            background: #e3f2fd;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            width: fit-content;
        }

        .students-count {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #666;
            gap: 4px;
        }

        .archived-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: #ff9800;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            z-index: 4;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: white;
        }

        .empty-state .material-icons {
            font-size: 120px;
            opacity: 0.5;
            margin-bottom: 24px;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .empty-state p {
            font-size: 16px;
            opacity: 0.9;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .close-btn:hover {
            background-color: #f5f5f5;
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: 'Noto Sans Bengali', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: #1976d2;
        }

        .form-input.required {
            border-left: 4px solid #1976d2;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 32px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            font-family: 'Noto Sans Bengali', sans-serif;
        }

        .btn-primary {
            background: #1976d2;
            color: white;
        }

        .btn-primary:hover {
            background: #1565c0;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d5d5d5;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .content-title {
                font-size: 24px;
            }

            .courses-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .sidebar {
                width: 100%;
                left: -100%;
            }

            .main-content.sidebar-open {
                margin-left: 0;
            }

            .user-details {
                display: none;
            }
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: white;
        }

        .loading .material-icons {
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Success/Error Messages */
        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }

        .message.info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <span class="material-icons menu-icon" id="menuIcon">menu</span>
            <h1 class="header-title" id="dashboardTitle">আমার ক্লাসরুম</h1>
            <div class="user-info">
                <div class="user-details">
                    <span class="user-email" id="currentUserEmail">user@example.com</span>
                    <span class="role-badge" id="userRoleBadge">নতুন ব্যবহারকারী</span>
                </div>
                <div class="user-avatar" id="userInitial">U</div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-item active">
                    <span class="material-icons">dashboard</span>
                    <span>ড্যাশবোর্ড</span>
                </div>
                <div class="sidebar-item">
                    <span class="material-icons">school</span>
                    <span>আমার কোর্স</span>
                </div>
                <div class="sidebar-item">
                    <span class="material-icons">archive</span>
                    <span>আর্কাইভ</span>
                </div>
                <div class="sidebar-item">
                    <span class="material-icons">settings</span>
                    <span>সেটিংস</span>
                </div>
                <div class="sidebar-item logout-btn" id="logoutBtn">
                    <span class="material-icons">logout</span>
                    <span>লগআউট</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="content-header">
                <h2 class="content-title" id="dashboardTitle">আমার ড্যাশবোর্ড</h2>
                <div class="add-course-container">
                    <button class="add-course-btn" id="addCourseBtn">
                        <span class="material-icons">add</span>
                        <span>কোর্স</span>
                    </button>
                    <div class="course-action-menu" id="courseActionMenu">
                        <!-- Menu items will be added dynamically -->
                    </div>
                </div>
            </div>

            <!-- Courses Grid -->
            <div class="courses-grid" id="coursesGrid">
                <!-- Course cards will be added dynamically -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <span class="material-icons">school</span>
                <h3>কোনো কোর্স নেই</h3>
                <p id="emptyStateText">আপনার প্রথম কোর্স তৈরি করুন অথবা একটি কোর্সে যোগ দিন</p>
            </div>
        </div>
    </div>

    <!-- Create Course Modal -->
    <div id="createCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">নতুন কোর্স তৈরি করুন</h3>
                <button class="close-btn" id="closeCreateModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="createCourseForm">
                    <div class="form-group">
                        <label class="form-label" for="courseName">কোর্সের নাম *</label>
                        <input type="text" id="courseName" name="courseName" class="form-input required" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="section">সেকশন</label>
                        <input type="text" id="section" name="section" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="subject">বিষয়</label>
                        <input type="text" id="subject" name="subject" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="room">রুম</label>
                        <input type="text" id="room" name="room" class="form-input">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelCreate">বাতিল</button>
                        <button type="submit" class="btn btn-primary">তৈরি করুন</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Join Course Modal -->
    <div id="joinCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">কোর্সে যোগ দিন</h3>
                <button class="close-btn" id="closeJoinModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="message info" style="margin-bottom: 20px;">
                    <span class="material-icons">info</span>
                    <span>আপনার শিক্ষক থেকে কোর্স কোডটি চান এবং এখানে লিখুন</span>
                </div>
                <form id="joinCourseForm">
                    <div class="form-group">
                        <label class="form-label" for="courseCode">কোর্স কোড *</label>
                        <input type="text" id="courseCode" name="courseCode" class="form-input required"
                            placeholder="উদাহরণ: ABC123D" required style="text-transform: uppercase;">
                        <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
                            কোর্স কোডটি ৫-৮ অক্ষরের হতে পারে (যেমন: ABC123D)
                        </small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelJoin">বাতিল</button>
                        <button type="submit" class="btn btn-primary">যোগ দিন</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div id="editCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">কোর্স সম্পাদনা করুন</h3>
                <button class="close-btn" id="closeEditModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editCourseForm">
                    <div class="form-group">
                        <label class="form-label" for="editCourseName">কোর্সের নাম *</label>
                        <input type="text" id="editCourseName" name="courseName" class="form-input required" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editCourseSection">সেকশন</label>
                        <input type="text" id="editCourseSection" name="section" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editCourseSubject">বিষয়</label>
                        <input type="text" id="editCourseSubject" name="subject" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editCourseRoom">রুম</label>
                        <input type="text" id="editCourseRoom" name="room" class="form-input">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelEdit">বাতিল</button>
                        <button type="submit" class="btn btn-primary">আপডেট করুন</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Elements
            const menuIcon = document.getElementById("menuIcon");
            const sidebar = document.getElementById("sidebar");
            const mainContent = document.getElementById("mainContent");
            const logoutBtn = document.getElementById("logoutBtn");
            const userInitial = document.getElementById("userInitial");
            const currentUserEmail = document.getElementById("currentUserEmail");
            const userRoleBadge = document.getElementById("userRoleBadge");
            const coursesGrid = document.getElementById("coursesGrid");
            const emptyState = document.getElementById("emptyState");
            const emptyStateText = document.getElementById("emptyStateText");
            const addCourseBtn = document.getElementById("addCourseBtn");
            const courseActionMenu = document.getElementById("courseActionMenu");
            const dashboardTitle = document.getElementById("dashboardTitle");

            // Modals
            const createCourseModal = document.getElementById("createCourseModal");
            const joinCourseModal = document.getElementById("joinCourseModal");
            const editCourseModal = document.getElementById("editCourseModal");
            const closeCreateModal = document.getElementById("closeCreateModal");
            const closeJoinModal = document.getElementById("closeJoinModal");
            const closeEditModal = document.getElementById("closeEditModal");
            const createCourseForm = document.getElementById("createCourseForm");
            const joinCourseForm = document.getElementById("joinCourseForm");
            const editCourseForm = document.getElementById("editCourseForm");
            const cancelCreate = document.getElementById("cancelCreate");
            const cancelJoin = document.getElementById("cancelJoin");
            const cancelEdit = document.getElementById("cancelEdit");

            // Get current user
            const currentUser = localStorage.getItem("currentUser");
            if (!currentUser) {
                window.location.href = "index.html";
                return;
            }

            // Initialize dashboard
            initializeDashboard();

            // Event listeners
            menuIcon.addEventListener("click", toggleSidebar);
            logoutBtn.addEventListener("click", handleLogout);
            addCourseBtn.addEventListener("click", toggleActionMenu);
            createCourseForm.addEventListener("submit", handleCreateCourse);
            joinCourseForm.addEventListener("submit", handleJoinCourse);
            editCourseForm.addEventListener("submit", handleEditCourse);
            closeCreateModal.addEventListener("click", hideCreateModal);
            closeJoinModal.addEventListener("click", hideJoinModal);
            closeEditModal.addEventListener("click", hideEditModal);
            cancelCreate.addEventListener("click", hideCreateModal);
            cancelJoin.addEventListener("click", hideJoinModal);
            cancelEdit.addEventListener("click", hideEditModal);

            // Current course being edited
            let currentEditingCourse = null;

            // Close modals when clicking outside
            window.addEventListener("click", function (e) {
                if (e.target === createCourseModal) {
                    hideCreateModal();
                }
                if (e.target === joinCourseModal) {
                    hideJoinModal();
                }
                if (e.target === editCourseModal) {
                    hideEditModal();
                }
                if (!addCourseBtn.contains(e.target) && !courseActionMenu.contains(e.target)) {
                    courseActionMenu.classList.remove("show");
                }
            });

            // Close sidebar when clicking outside
            document.addEventListener("click", function (e) {
                if (!sidebar.contains(e.target) && !menuIcon.contains(e.target)) {
                    sidebar.classList.remove("open");
                    mainContent.classList.remove("sidebar-open");
                }
            });

            // Close menus when clicking outside
            document.addEventListener("click", function (e) {
                if (!e.target.closest(".course-card-menu")) {
                    document.querySelectorAll(".course-menu-dropdown").forEach((menu) => {
                        menu.classList.remove("show");
                    });
                }
            });

            function initializeDashboard() {
                currentUserEmail.textContent = currentUser;
                userInitial.textContent = currentUser.charAt(0).toUpperCase();
                const userDashboard = getUserDashboard();
                const userRole = getUserRole();
                updateUIForRole(userRole);
                loadUserCourses();

                // Debug: Log current user and available courses
                console.log("Current user:", currentUser);
                console.log("User role:", userRole);
                debugCourses();
            }

            function getUserDashboard() {
                const dashboardKey = `dashboard_${currentUser}`;
                const dashboard = JSON.parse(localStorage.getItem(dashboardKey) || '{"courses": [], "role": null}');

                // Ensure courses array exists
                if (!dashboard.courses) {
                    dashboard.courses = [];
                }

                return dashboard;
            }

            function saveUserDashboard(dashboard) {
                const dashboardKey = `dashboard_${currentUser}`;
                localStorage.setItem(dashboardKey, JSON.stringify(dashboard));
            }

            function getUserRole() {
                const dashboard = getUserDashboard();
                return dashboard.role;
            }

            function setUserRole(role) {
                const dashboard = getUserDashboard();
                dashboard.role = role;
                saveUserDashboard(dashboard);

                // Also update in registeredUsers
                const registeredUsers = JSON.parse(localStorage.getItem("registeredUsers") || "[]");
                const userIndex = registeredUsers.findIndex((u) => u.email === currentUser);
                if (userIndex !== -1) {
                    registeredUsers[userIndex].role = role;
                    localStorage.setItem("registeredUsers", JSON.stringify(registeredUsers));
                }

                localStorage.setItem("userRole", role);
            }

            function updateUIForRole(role) {
                switch (role) {
                    case "teacher":
                        userRoleBadge.textContent = "শিক্ষক";
                        userRoleBadge.className = "role-badge teacher";
                        dashboardTitle.textContent = "শিক্ষক ড্যাশবোর্ড";
                        emptyStateText.textContent = "আপনার প্রথম কোর্স তৈরি করুন অথবা অন্য কোর্সে যোগ দিন";
                        break;
                    case "student":
                        userRoleBadge.textContent = "শিক্ষার্থী";
                        userRoleBadge.className = "role-badge student";
                        dashboardTitle.textContent = "শিক্ষার্থী ড্যাশবোর্ড";
                        emptyStateText.textContent = "কোর্স কোড দিয়ে কোর্সে যোগ দিন";
                        break;
                    default:
                        userRoleBadge.textContent = "নতুন ব্যবহারকারী";
                        userRoleBadge.className = "role-badge new";
                        dashboardTitle.textContent = "আমার ক্লাসরুম";
                        emptyStateText.textContent = "আপনার প্রথম কোর্স তৈরি করুন অথবা একটি কোর্সে যোগ দিন";
                }
                updateActionMenu(role);
            }

            function updateActionMenu(role) {
                courseActionMenu.innerHTML = "";
                if (role === "student") {
                    // Only show join option for students
                    showStudentActions();
                } else {
                    // Show both create and join options for teachers and new users
                    showTeacherActions();
                }
            }

            function showStudentActions() {
                const joinItem = document.createElement("div");
                joinItem.className = "dropdown-item";
                joinItem.onclick = showJoinModal;
                const joinIcon = document.createElement("span");
                joinIcon.className = "material-icons";
                joinIcon.textContent = "add";
                const joinText = document.createTextNode("কোর্সে যোগ দিন");
                joinItem.appendChild(joinIcon);
                joinItem.appendChild(joinText);
                courseActionMenu.appendChild(joinItem);
            }

            function showTeacherActions() {
                // Create course option
                const createItem = document.createElement("div");
                createItem.className = "dropdown-item";
                createItem.onclick = showCreateModal;
                const createIcon = document.createElement("span");
                createIcon.className = "material-icons";
                createIcon.textContent = "add";
                const createText = document.createTextNode("নতুন কোর্স তৈরি করুন");
                createItem.appendChild(createIcon);
                createItem.appendChild(createText);
                courseActionMenu.appendChild(createItem);

                // Join course option
                const joinItem = document.createElement("div");
                joinItem.className = "dropdown-item";
                joinItem.onclick = showJoinModal;
                const joinIcon = document.createElement("span");
                joinIcon.className = "material-icons";
                joinIcon.textContent = "group_add";
                const joinText = document.createTextNode("কোর্সে যোগ দিন");
                joinItem.appendChild(joinIcon);
                joinItem.appendChild(joinText);
                courseActionMenu.appendChild(joinItem);
            }

            function toggleSidebar() {
                sidebar.classList.toggle("open");
                mainContent.classList.toggle("sidebar-open");
            }

            function handleLogout() {
                localStorage.removeItem("currentUser");
                localStorage.removeItem("userRole");
                window.location.href = "index.html";
            }

            function toggleActionMenu() {
                courseActionMenu.classList.toggle("show");
            }

            function showCreateModal() {
                createCourseModal.style.display = "block";
                courseActionMenu.classList.remove("show");
            }

            function showJoinModal() {
                joinCourseModal.style.display = "block";
                courseActionMenu.classList.remove("show");
            }

            function showEditModal() {
                editCourseModal.style.display = "block";
            }

            function hideCreateModal() {
                createCourseModal.style.display = "none";
                createCourseForm.reset();
            }

            function hideJoinModal() {
                joinCourseModal.style.display = "none";
                joinCourseForm.reset();
            }

            function hideEditModal() {
                editCourseModal.style.display = "none";
                editCourseForm.reset();
                currentEditingCourse = null;
            }

            function handleCreateCourse(e) {
                e.preventDefault();
                const formData = new FormData(createCourseForm);
                const courseName = formData.get("courseName").trim();
                const section = formData.get("section").trim() || "সেকশন নির্দিষ্ট করা হয়নি";
                const subject = formData.get("subject").trim() || "বিষয় নির্দিষ্ট করা হয়নি";
                const room = formData.get("room").trim() || "রুম নির্দিষ্ট করা হয়নি";

                // Enhanced validation
                if (!courseName) {
                    alert("অনুগ্রহ করে কোর্সের নাম লিখুন");
                    document.querySelector('input[name="courseName"]').focus();
                    return;
                }

                if (courseName.length < 3) {
                    alert("কোর্সের নাম অন্তত ৩ অক্ষরের হতে হবে");
                    return;
                }

                const courseCode = generateCourseCode();
                const newCourse = {
                    id: Date.now().toString(),
                    name: courseName,
                    section: section,
                    subject: subject,
                    room: room,
                    code: courseCode,
                    teacher: currentUser,
                    students: [],
                    created: new Date().toISOString(),
                    archived: false,
                };

                // Check if course already exists for this teacher
                const dashboard = getUserDashboard();
                const existingCourse = dashboard.courses.find(
                    (c) => c.name.toLowerCase() === courseName.toLowerCase() &&
                        c.section === section &&
                        c.teacher === currentUser
                );

                if (existingCourse) {
                    alert("এই নামে এবং সেকশনে আপনার একটি কোর্স ইতিমধ্যে রয়েছে");
                    return;
                }

                // Add course to current user and global list
                addCourseToUser(newCourse);
                addCourseToGlobalList(newCourse);

                // Set role as teacher
                setUserRole("teacher");

                hideCreateModal();
                loadUserCourses();
                updateUIForRole("teacher");

                alert(`কোর্স সফলভাবে তৈরি হয়েছে!\n\nকোর্স কোড: ${courseCode}\n\nএই কোড শিক্ষার্থীদের সাথে শেয়ার করুন যাতে তারা আপনার কোর্সে যোগ দিতে পারে।`);
            }

            function handleJoinCourse(e) {
                e.preventDefault();
                const formData = new FormData(joinCourseForm);
                let courseCode = formData.get("courseCode");

                // Input validation and sanitization
                if (!courseCode) {
                    alert("অনুগ্রহ করে কোর্স কোড লিখুন");
                    document.querySelector('input[name="courseCode"]').focus();
                    return;
                }

                // Clean and format course code
                courseCode = courseCode.trim().toUpperCase().replace(/\s+/g, '');

                if (courseCode.length < 3) {
                    alert("কোর্স কোড কমপক্ষে ৩ অক্ষরের হতে হবে");
                    return;
                }

                console.log("Attempting to join course with code:", courseCode);

                // Find course
                const course = findCourseByCode(courseCode);

                if (!course) {
                    alert(`কোর্স খুঁজে পাওয়া যায়নি।\n\nআপনার কোড: "${courseCode}"\n\nঅনুগ্রহ করে:\n• কোর্স কোড সঠিক কিনা যাচাই করুন\n• বড় ও ছোট হাতের অক্ষর সঠিক আছে কিনা দেখুন\n• শিক্ষকের কাছ থেকে সঠিক কোড নিশ্চিত করুন`);
                    console.log("Available course codes:", getAllCourseCodes());
                    return;
                }

                console.log("Found course:", course.name, "by teacher:", course.teacher);

                // Check if user is the teacher of this course
                if (course.teacher === currentUser) {
                    alert("আপনি এই কোর্সের শিক্ষক। আপনি নিজের কোর্সে শিক্ষার্থী হিসেবে যোগ দিতে পারবেন না।");
                    return;
                }

                // Check if already enrolled
                if (course.students && course.students.includes(currentUser)) {
                    alert("আপনি ইতিমধ্যে এই কোর্সে যোগদান করেছেন।");
                    loadUserCourses(); // Refresh to show the course if it's not visible
                    hideJoinModal();
                    return;
                }

                // Check if course is already in user's dashboard
                const userDashboard = getUserDashboard();
                const existingCourse = userDashboard.courses.find(c => c.id === course.id);
                if (existingCourse) {
                    alert("এই কোর্সটি আপনার ড্যাশবোর্ডে ইতিমধ্যে রয়েছে।");
                    hideJoinModal();
                    return;
                }

                // Join the course
                const joinResult = joinCourse(course);

                if (joinResult.success) {
                    // Set role as student if not already a teacher
                    const currentRole = getUserRole();
                    if (currentRole !== "teacher") {
                        setUserRole("student");
                        updateUIForRole("student");
                    }

                    hideJoinModal();
                    loadUserCourses();

                    alert(`সফলভাবে কোর্সে যোগদান করেছেন!\n\nকোর্স: ${course.name}\nশিক্ষক: ${course.teacher}\nসেকশন: ${course.section}\n\nএখন আপনি এই কোর্সের সকল বিষয়বস্তু দেখতে পারবেন।`);
                } else {
                    alert(`কোর্সে যোগদানে সমস্যা হয়েছে: ${joinResult.message}\n\nআবার চেষ্টা করুন অথবা শিক্ষকের সাথে যোগাযোগ করুন।`);
                }
            }

            function handleEditCourse(e) {
                e.preventDefault();
                if (!currentEditingCourse) return;

                const formData = new FormData(editCourseForm);
                const courseName = formData.get("courseName").trim();
                const section = formData.get("section").trim() || "";
                const subject = formData.get("subject").trim() || "";
                const room = formData.get("room").trim() || "";

                if (!courseName) {
                    alert("কোর্সের নাম লিখুন");
                    return;
                }

                if (courseName.length < 3) {
                    alert("কোর্সের নাম অন্তত ৩ অক্ষরের হতে হবে");
                    return;
                }

                const updates = {
                    name: courseName,
                    section: section,
                    subject: subject,
                    room: room,
                    modified: new Date().toISOString()
                };

                updateCourse(currentEditingCourse.id, updates);

                hideEditModal();
                loadUserCourses();
                alert("কোর্স সফলভাবে আপডেট হয়েছে!");
            }

            function generateCourseCode() {
                // Generate a more user-friendly course code
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = '';
                for (let i = 0; i < 7; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }

                // Make sure the code is unique
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                if (allCourses.some(course => course.code === result)) {
                    return generateCourseCode(); // Generate again if duplicate
                }

                return result;
            }

            function addCourseToUser(course) {
                const dashboard = getUserDashboard();
                dashboard.courses.push(course);
                saveUserDashboard(dashboard);
                console.log("Added course to user dashboard:", course.name);
            }

            function addCourseToGlobalList(course) {
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                allCourses.push(course);
                localStorage.setItem("allCourses", JSON.stringify(allCourses));
                console.log("Added course to global list:", course.name, "Code:", course.code);
            }

            function findCourseByCode(code) {
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                console.log("Searching for course code:", code);
                console.log("Available courses:", allCourses.length);

                // Log all available course codes for debugging
                allCourses.forEach((course, index) => {
                    console.log(`Course ${index + 1}: ${course.name} - Code: ${course.code} - Teacher: ${course.teacher}`);
                });

                const foundCourse = allCourses.find(
                    (course) => course.code && course.code.toUpperCase().trim() === code.toUpperCase().trim()
                );

                console.log("Found course:", foundCourse ? foundCourse.name : "None");
                return foundCourse;
            }

            function getAllCourseCodes() {
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                return allCourses.map(course => course.code).filter(code => code);
            }

            function joinCourse(course) {
                try {
                    console.log("Joining course:", course.name);
                    console.log("Course teacher:", course.teacher);
                    console.log("Current user:", currentUser);

                    // Initialize students array if it doesn't exist
                    if (!course.students) {
                        course.students = [];
                    }

                    // Add current user to course's student list
                    if (!course.students.includes(currentUser)) {
                        course.students.push(currentUser);
                        console.log("Added student to course. Total students:", course.students.length);
                    }

                    // Update course in global courses list
                    const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                    const courseIndex = allCourses.findIndex((c) => c.id === course.id);
                    if (courseIndex !== -1) {
                        allCourses[courseIndex] = { ...course };
                        localStorage.setItem("allCourses", JSON.stringify(allCourses));
                        console.log("Updated course in global list");
                    } else {
                        console.error("Course not found in global list");
                        return { success: false, message: "Course not found in system" };
                    }

                    // Add course to current user's dashboard
                    const dashboard = getUserDashboard();
                    const existingCourseIndex = dashboard.courses.findIndex((c) => c.id === course.id);

                    if (existingCourseIndex === -1) {
                        dashboard.courses.push({ ...course });
                        console.log("Added course to user dashboard");
                    } else {
                        dashboard.courses[existingCourseIndex] = { ...course };
                        console.log("Updated existing course in user dashboard");
                    }

                    saveUserDashboard(dashboard);

                    // Update teacher's dashboard as well
                    updateTeacherDashboard(course);

                    return { success: true, message: "Successfully joined course" };
                } catch (error) {
                    console.error("Error joining course:", error);
                    return { success: false, message: `Error: ${error.message}` };
                }
            }

            function updateTeacherDashboard(course) {
                try {
                    const teacherDashboardKey = `dashboard_${course.teacher}`;
                    const teacherDashboard = JSON.parse(
                        localStorage.getItem(teacherDashboardKey) || '{"courses": [], "role": "teacher"}'
                    );

                    const teacherCourseIndex = teacherDashboard.courses.findIndex((c) => c.id === course.id);
                    if (teacherCourseIndex !== -1) {
                        teacherDashboard.courses[teacherCourseIndex] = { ...course };
                        localStorage.setItem(teacherDashboardKey, JSON.stringify(teacherDashboard));
                        console.log("Updated teacher's dashboard");
                    }
                } catch (error) {
                    console.error("Error updating teacher dashboard:", error);
                }
            }

            function loadUserCourses() {
                const dashboard = getUserDashboard();
                let courses = dashboard.courses || [];

                // Remove duplicates based on course ID
                const uniqueCourses = [];
                const seenIds = new Set();

                courses.forEach(course => {
                    if (!seenIds.has(course.id)) {
                        seenIds.add(course.id);
                        uniqueCourses.push(course);
                    }
                });

                // Update dashboard if we found duplicates
                if (uniqueCourses.length !== courses.length) {
                    dashboard.courses = uniqueCourses;
                    saveUserDashboard(dashboard);
                    courses = uniqueCourses;
                    console.log("Removed duplicate courses from dashboard");
                }

                if (courses.length === 0) {
                    emptyState.style.display = "block";
                    coursesGrid.innerHTML = "";
                    return;
                }

                emptyState.style.display = "none";
                renderCourses(courses);
            }

            function renderCourses(courses) {
                coursesGrid.innerHTML = "";
                courses.forEach((course) => {
                    const courseCard = createCourseCard(course);
                    coursesGrid.appendChild(courseCard);
                });
            }

            function createCourseCard(course) {
                const card = document.createElement("div");
                card.className = `course-card ${course.archived ? "archived" : ""}`;
                card.onclick = () => openCourse(course);

                const headerClass = getHeaderClass(course.subject);

                // Archived badge
                if (course.archived) {
                    const archivedBadge = document.createElement("div");
                    archivedBadge.className = "archived-badge";
                    archivedBadge.textContent = "আর্কাইভ";
                    card.appendChild(archivedBadge);
                }

                // Course Header
                const courseHeader = document.createElement("div");
                courseHeader.className = `course-header ${headerClass}`;

                const headerContent = document.createElement("div");
                headerContent.className = "course-header-content";

                const courseTitle = document.createElement("h3");
                courseTitle.className = "course-title";
                courseTitle.textContent = course.name;

                const courseSection = document.createElement("p");
                courseSection.className = "course-section";
                courseSection.textContent = `সেকশন: ${course.section}`;

                headerContent.appendChild(courseTitle);
                headerContent.appendChild(courseSection);

                // Header Menu (only for teachers/course creators)
                const headerMenu = document.createElement("div");
                headerMenu.className = "course-header-menu";

                if (course.teacher === currentUser) {
                    const cardMenu = document.createElement("div");
                    cardMenu.className = "course-card-menu";

                    const menuIcon = document.createElement("span");
                    menuIcon.className = "material-icons course-menu";
                    menuIcon.textContent = "more_vert";
                    menuIcon.onclick = (e) => {
                        e.stopPropagation();
                        toggleCourseMenu(course.id);
                    };

                    const menuDropdown = document.createElement("div");
                    menuDropdown.className = "course-menu-dropdown";
                    menuDropdown.id = `courseMenu_${course.id}`;

                    // Edit option
                    const editItem = document.createElement("div");
                    editItem.className = "course-menu-item";
                    editItem.onclick = () => editCourse(course.id);
                    const editIcon = document.createElement("span");
                    editIcon.className = "material-icons";
                    editIcon.textContent = "edit";
                    const editText = document.createTextNode("সম্পাদনা");
                    editItem.appendChild(editIcon);
                    editItem.appendChild(editText);

                    // Archive option
                    const archiveItem = document.createElement("div");
                    archiveItem.className = "course-menu-item archive";
                    archiveItem.onclick = () => toggleArchiveCourse(course.id);
                    const archiveIcon = document.createElement("span");
                    archiveIcon.className = "material-icons";
                    archiveIcon.textContent = course.archived ? "unarchive" : "archive";
                    const archiveText = document.createTextNode(course.archived ? "আনআর্কাইভ" : "আর্কাইভ");
                    archiveItem.appendChild(archiveIcon);
                    archiveItem.appendChild(archiveText);

                    // Delete option
                    const deleteItem = document.createElement("div");
                    deleteItem.className = "course-menu-item delete";
                    deleteItem.onclick = () => deleteCourse(course.id);
                    const deleteIcon = document.createElement("span");
                    deleteIcon.className = "material-icons";
                    deleteIcon.textContent = "delete";
                    const deleteText = document.createTextNode("মুছুন");
                    deleteItem.appendChild(deleteIcon);
                    deleteItem.appendChild(deleteText);

                    menuDropdown.appendChild(editItem);
                    menuDropdown.appendChild(archiveItem);
                    menuDropdown.appendChild(deleteItem);

                    cardMenu.appendChild(menuIcon);
                    cardMenu.appendChild(menuDropdown);
                    headerMenu.appendChild(cardMenu);
                }

                courseHeader.appendChild(headerContent);
                courseHeader.appendChild(headerMenu);

                // Course Body
                const courseBody = document.createElement("div");
                courseBody.className = "course-body";

                const bodyContent = document.createElement("div");
                bodyContent.className = "course-body-content";

                const courseInfo = document.createElement("div");
                courseInfo.className = "course-info";

                // Course code
                const courseCode = document.createElement("p");
                courseCode.className = "course-code";
                courseCode.textContent = `কোড: ${course.code}`;

                // Student count with proper initialization
                const studentsCount = document.createElement("p");
                studentsCount.className = "students-count";
                const studentCount = course.students ? course.students.length : 0;
                studentsCount.innerHTML = `
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle;">people</span>
                    ${studentCount} জন শিক্ষার্থী
                `;

                // Teacher info (for students)
                const teacherInfo = document.createElement("p");
                teacherInfo.style.fontSize = "14px";
                teacherInfo.style.color = "#666";
                teacherInfo.innerHTML = `
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle;">person</span>
                    শিক্ষক: ${course.teacher}
                `;

                // Created date
                const createdDate = document.createElement("p");
                createdDate.style.fontSize = "12px";
                createdDate.style.color = "#999";
                createdDate.textContent = `তৈরি: ${new Date(course.created).toLocaleDateString("bn-BD")}`;

                courseInfo.appendChild(courseCode);
                if (course.teacher !== currentUser) {
                    courseInfo.appendChild(teacherInfo);
                }
                courseInfo.appendChild(studentsCount);
                courseInfo.appendChild(createdDate);

                bodyContent.appendChild(courseInfo);
                courseBody.appendChild(bodyContent);

                card.appendChild(courseHeader);
                card.appendChild(courseBody);

                return card;
            }

            function getHeaderClass(subject) {
                const subjectLower = subject.toLowerCase();
                if (subjectLower.includes("math") || subjectLower.includes("গণিত")) return "math";
                if (subjectLower.includes("science") || subjectLower.includes("বিজ্ঞান")) return "science";
                if (subjectLower.includes("bangla") || subjectLower.includes("বাংলা")) return "bangla";
                if (subjectLower.includes("english") || subjectLower.includes("ইংরেজি")) return "english";
                if (subjectLower.includes("programming") || subjectLower.includes("প্রোগ্রামিং")) return "programming";
                return "";
            }

            function toggleCourseMenu(courseId) {
                const menu = document.getElementById(`courseMenu_${courseId}`);
                document.querySelectorAll(".course-menu-dropdown").forEach((m) => {
                    if (m !== menu) m.classList.remove("show");
                });
                menu.classList.toggle("show");
            }

            function editCourse(courseId) {
                const dashboard = getUserDashboard();
                const course = dashboard.courses.find((c) => c.id === courseId);
                if (!course) return;

                currentEditingCourse = course;
                document.getElementById("editCourseName").value = course.name;
                document.getElementById("editCourseSection").value = course.section;
                document.getElementById("editCourseSubject").value = course.subject;
                document.getElementById("editCourseRoom").value = course.room;
                showEditModal();
            }

            function updateCourse(courseId, updates) {
                // Update in user dashboard
                const dashboard = getUserDashboard();
                const courseIndex = dashboard.courses.findIndex((c) => c.id === courseId);
                if (courseIndex !== -1) {
                    dashboard.courses[courseIndex] = { ...dashboard.courses[courseIndex], ...updates };
                    saveUserDashboard(dashboard);
                }

                // Update in global courses list
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                const allCoursesIndex = allCourses.findIndex((c) => c.id === courseId);
                if (allCoursesIndex !== -1) {
                    allCourses[allCoursesIndex] = { ...allCourses[allCoursesIndex], ...updates };
                    localStorage.setItem("allCourses", JSON.stringify(allCourses));
                }

                // Update in all enrolled students' dashboards
                const course = allCourses[allCoursesIndex];
                if (course && course.students) {
                    course.students.forEach(studentEmail => {
                        if (studentEmail !== currentUser) {
                            const studentDashboardKey = `dashboard_${studentEmail}`;
                            const studentDashboard = JSON.parse(localStorage.getItem(studentDashboardKey) || '{"courses": []}');
                            const studentCourseIndex = studentDashboard.courses.findIndex(c => c.id === courseId);
                            if (studentCourseIndex !== -1) {
                                studentDashboard.courses[studentCourseIndex] = { ...studentDashboard.courses[studentCourseIndex], ...updates };
                                localStorage.setItem(studentDashboardKey, JSON.stringify(studentDashboard));
                            }
                        }
                    });
                }
            }

            function toggleArchiveCourse(courseId) {
                const dashboard = getUserDashboard();
                const course = dashboard.courses.find((c) => c.id === courseId);
                if (!course) return;

                const newArchivedStatus = !course.archived;
                const confirmMessage = newArchivedStatus ?
                    "আপনি কি এই কোর্সটি আর্কাইভ করতে চান?" :
                    "আপনি কি এই কোর্সটি আনআর্কাইভ করতে চান?";

                if (!confirm(confirmMessage)) return;

                updateCourse(courseId, { archived: newArchivedStatus });
                loadUserCourses();
            }

            function deleteCourse(courseId) {
                if (!confirm("আপনি কি নিশ্চিত যে এই কোর্সটি স্থায়ীভাবে মুছে দিতে চান?\n\nএটি পুনরুদ্ধার করা যাবে না।")) return;

                // Remove from user dashboard
                const dashboard = getUserDashboard();
                dashboard.courses = dashboard.courses.filter((c) => c.id !== courseId);
                saveUserDashboard(dashboard);

                // Remove from global courses list
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                const filteredCourses = allCourses.filter((c) => c.id !== courseId);
                localStorage.setItem("allCourses", JSON.stringify(filteredCourses));

                // Remove from all students' dashboards
                const courseToDelete = allCourses.find(c => c.id === courseId);
                if (courseToDelete && courseToDelete.students) {
                    courseToDelete.students.forEach(studentEmail => {
                        const studentDashboardKey = `dashboard_${studentEmail}`;
                        const studentDashboard = JSON.parse(localStorage.getItem(studentDashboardKey) || '{"courses": []}');
                        studentDashboard.courses = studentDashboard.courses.filter(c => c.id !== courseId);
                        localStorage.setItem(studentDashboardKey, JSON.stringify(studentDashboard));
                    });
                }

                loadUserCourses();
                alert("কোর্স সফলভাবে মুছে দেওয়া হয়েছে।");
            }

            function openCourse(course) {
                // Store selected course for the detail page
                localStorage.setItem("selectedCourse", JSON.stringify(course));
                // Navigate to course detail page
                window.location.href = "course-detail.html";
            }

            // Debug function to check available courses
            function debugCourses() {
                const allCourses = JSON.parse(localStorage.getItem("allCourses") || "[]");
                console.log("=== Debug: Available Courses ===");
                console.log(`Total courses: ${allCourses.length}`);
                allCourses.forEach((course, index) => {
                    console.log(`${index + 1}. Name: "${course.name}"`);
                    console.log(`   Code: "${course.code}"`);
                    console.log(`   Teacher: "${course.teacher}"`);
                    console.log(`   Students: ${course.students ? course.students.length : 0}`);
                    console.log(`   Created: ${course.created}`);
                    console.log(`   ---`);
                });
                console.log("=== End Debug ===");

                // Also check current user's dashboard
                const dashboard = getUserDashboard();
                console.log("=== Current User Dashboard ===");
                console.log(`User: ${currentUser}`);
                console.log(`Role: ${dashboard.role}`);
                console.log(`Courses: ${dashboard.courses.length}`);
                dashboard.courses.forEach((course, index) => {
                    console.log(`${index + 1}. ${course.name} (${course.code})`);
                });
                console.log("=== End Dashboard ===");
            }

            // Global functions for debugging
            window.debugCourses = debugCourses;
            window.clearAllCourses = function () {
                if (confirm("আপনি কি সব কোর্স মুছে দিতে চান? এটি সিস্টেম থেকে সব কোর্স সরিয়ে দেবে।")) {
                    localStorage.removeItem("allCourses");
                    // Clear all user dashboards
                    const registeredUsers = JSON.parse(localStorage.getItem("registeredUsers") || "[]");
                    registeredUsers.forEach(user => {
                        const dashboardKey = `dashboard_${user.email}`;
                        const dashboard = JSON.parse(localStorage.getItem(dashboardKey) || '{}');
                        dashboard.courses = [];
                        localStorage.setItem(dashboardKey, JSON.stringify(dashboard));
                    });
                    location.reload();
                }
            };

            // Global functions for onclick events
            window.showCreateModal = showCreateModal;
            window.showJoinModal = showJoinModal;
            window.toggleCourseMenu = toggleCourseMenu;
            window.editCourse = editCourse;
            window.toggleArchiveCourse = toggleArchiveCourse;
            window.deleteCourse = deleteCourse;
        });
    </script>
</body>

</html>